%
% Шаблон магистерской диссертации
%

\documentclass[a4paper,12pt]{article}
\usepackage[backend=biber,sorting=none,style=gost-numeric,autolang=other]{biblatex} % библиография
\usepackage{mathtext} %русские буквы в формулах
\usepackage[T2A]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[english,russian]{babel}
\usepackage{amsmath}
\usepackage{fancyvrb}
\usepackage{formular}
\usepackage{setspace} % управление междустрочными интервалами
%поля документа
\usepackage[left=3cm,right=1.5cm,top=2.5cm,bottom=2.5cm]{geometry}

\usepackage{misccorr} % точки в конце номеров разделов, использовать перед пакетом ccaption!
\usepackage{ccaption} % изменения подписей к рисункам и табл.

\usepackage[nooneline]{caption} 
\captionsetup[table]{justification=raggedright} % заголовок таблицы выравнивается влево
\captionsetup[figure]{justification=centering,labelsep=endash} % заголовок рисунка - по центру

% отступ перед первым абзацем
\usepackage{indentfirst}
%вставка изображений
\usepackage{graphicx}
% счетчики
\usepackage{totcount}
% управление содержанием
\usepackage{tocloft}
% управление таблицами и рисунками
\usepackage{float}

\newcounter{mycitecount}                                %% Счётчик библиографии
\AtEveryBibitem{\stepcounter{mycitecount}}              %% Работает для biblatex

\usepackage[figure,      %
            table,       %
            mycitecount, xspace ]{totalcount}           %% Подсчёт общего количества объектов в документе

% окружение для листингов - с нумерацией строк слева
\DefineVerbatimEnvironment{MyCode}{Verbatim}{frame=lines,numbers=left,numberblanklines=false,framesep=5mm}

% автоматическая нумерация листингов
\newfloat{Program}{phb}{lop}
\floatname{Program}{Листинг}
\floatstyle{ruled}

\setcounter{secnumdepth}{3} % глубина нумерации до подразделов

%если нужны точки в оглавлении для разделов - раскомментируйте следующую команду
%\renewcommand{\cftsecleader}{\cftdotfill{\cftdotsep}}

\addto\captionsrussian{%
\renewcommand{\figurename}{Рисунок}%
\renewcommand{\tablename}{Таблица}%
}

% дефис в подписи к рисункам
\captiondelim{ -- } 

% Настройки для окружений с подчеркиваниями для подписей и пр.
\setFRMfontencoding{T2A}
\setFRMdfontencoding{T2A}
% thanks to A.Starikov
\setFRMfontfamily{cmr}
\setFRMdfontfamily{ptm}
\setFRMdfontsize{10pt}

% задает длину поля для подписи на титульной странице
\newFRMfield{xtitlesign}{32mm}

% поле для факультета или кафедры
\newFRMfield{fcath}{65mm}

%имя файла с библиографией в формате BibTex
\addbibresource{rbiblio.bib}

\begin{document}

% счетчики страниц, рисунков, таблиц
\regtotcounter{page}
\regtotcounter{figure}
\regtotcounter{table}

\renewcommand{\refname}{\centerline{СПИСОК ИСПОЛЬЗОВАННОЙ ЛИТЕРАТУРЫ}} 
\renewcommand{\contentsname}{\centerline{СОДЕРЖАНИЕ}} 
%\renewcommand{\refname}{Список источников}  % По умолчанию "Список литературы" (article)
%\renewcommand{\bibname}{Литература}  % По умолчанию "Литература" (book и report)

% титульная страница
\thispagestyle{empty}
\begin{center} \small
\textbf{МИНИСТЕРСТВО ОБРАЗОВАНИЯ И НАУКИ РОССИЙСКОЙ ФЕДЕРАЦИИ}\\
ФЕДЕРАЛЬНОЕ ГОСУДАРСТВЕННОЕ АВТОНОМНОЕ ОБРАЗОВАТЕЛЬНОЕ УЧРЕЖДЕНИЕ
ВЫСШЕГО  ОБРАЗОВАНИЯ\\
«Национальный исследовательский ядерный университет «МИФИ»\\
\textbf{Обнинский институт атомной энергетики} – \\
филиал федерального государственного автономного образовательного учреждения высшего\\
образования «Национальный исследовательский ядерный университет «МИФИ»\\
(ИАТЭ НИЯУ МИФИ)
\end{center}
%\vfill
\medskip

% Направление подготовки следует уточнять,
% магистры и бакалавры могут иметь разные наименования
\begin{center}
\begin{tabular}{rl}
Отделение & \useFRMfield{fcath}[\large Интеллектуальные кибернетические системы] \\ 
%Направление подготовки & \useFRMfield{fcath}[\large Информационные системы и технологии] \\ 
\end{tabular} 
\end{center}

\vfill

\large 

\begin{center}
\textbf{\Large Выпускная квалификационная работа --- } \\
\textbf{\Large магистерская диссертация}\\
	
	\medskip
по направлению подготовки: \textbf{09.04.02 Информационные  \\ системы и технологии}\\

Направленность (профиль): \textbf{Информационные системы}
	
\vfill
\vfill
\medskip

\textbf{\Large 
	<<Контроль электроэнергии и водоснабжения в рамках Умного города>>
}

\end{center}

\vspace{1cm}

\begin{tabular*}{\textwidth}{p{78mm}p{33mm}p{64mm}}
Выполнил:\\студент гр. ИС-М18 & \useFRMfield{xtitlesign} & Кузнецов~А.В.\\
& & \\
Руководитель ВКР,\\
профессор отделения ИКС, \\
докт.техн.наук & \useFRMfield{xtitlesign} & Яцало~Б.И. \\
& & \\

Нормоконтроль & \useFRMfield{xtitlesign} & Пичугина~И.А. \\
& & \\
% Если нужно добавить консультанта - раскомментируйте две строчки ниже
%Консультант ВКР бакалавра\\организация, должность, звание  & \useFRMfield{xtitlesign} & К.О.Нсультант\\
%& & \\
%	Рецензент\\к.ф.-м.н.,   & \useFRMfield{xtitlesign} & В.А. Чепурко\\

& & \\
Выпускная квалификационная \\ работа допущена к защите & \useFRMfield{xtitlesign} &  \\
& & \\
Руководитель\\ образовательной программы \\
09.04.02 Информационные системы и технологии,\\
докт.техн.наук  & \useFRMfield{xtitlesign} &Яцало~Б.И. \\

\end{tabular*}


\vfill
\large

\begin{center}
Обнинск, 2020 г
\end{center}

\onehalfspacing

\pagebreak

% реферат
\thispagestyle{empty}

\section*{\centering РЕФЕРАТ}

\total{page} стр., \total{table} табл., \total{figure} рис., \totalmycitecounts ист. 

УМНЫЙ ГОРОД, ИНТЕРНЕТ ВЕЩЕЙ, СИСТЕМА УЧЕТА РЕСУРСОВ, ПРИБОР УЧЕТА, АНАЛИЗ ДАННЫХ, POSTGRESQL, JAVA

Данная магистерская диссертация посвящена разработке программного обеспечения системы учета ресурсов в жилых зданиях с использованием аппаратной части для сбора данных с контроллеров приборов учета. Этот модуль является компонентом системы Умный город. 

Главная цель это своевременное выявление неисправного оборудования, что позволяет уменьшить общедомовые нужды.
Полученные часовые, суточные и ежемесячные данные в виде таблиц и графиков могут использовать как обычные пользователи, так и администрация города, управляющие компании, ТСЖ/ЖСК и другие.

Аппаратная часть включает в себя одноплатный миникомпьютер Raspberry Pi 2 model B, контроллер приборов учета и счётчики.

Программная часть состоит из баз данных на Firebird 2.5, postgreSQL и программы, написанной в PyQt5 на языке программирования Python.

Разработанная система учета ресурсов позволяет проводить анализ данных показаний квартирных и домовых приборов учета

В процессе работы был проведен анализ существующих решений проблем, изучены компоненты системы Умный город, разработано программное обеспечение системы учета ресурсов и проведено тестирование, в результате которого проверена работа программы.

Данная система используется в новостройках района «Заовражье» города Обнинск.

\pagebreak
\thispagestyle{empty}

\section*{\centering ОПРЕДЕЛЕНИЯ}

Умный город --- концепция интеграции нескольких информационных и коммуникационных технологий (ИКТ) и интернета вещей (IoT решения) для управления городским имуществом.

Интернет вещей (Internet of Things, IoT) --- концепция вычислительной сети физических предметов («вещей»), оснащённых встроенными технологиями для взаимодействия друг с другом или с внешней средой, рассматривающая организацию таких сетей как явление, способное перестроить экономические и общественные процессы, исключающее из части действий и операций необходимость участия человека. 

Геркон --- электромеханическое коммутационное устройство, изменяющее состояние подключённой электрической цепи при воздействии магнитного поля от постоянного магнита или внешнего электромагнита, например, соленоида.

\pagebreak

\section*{\centering ОБОЗНАЧЕНИЯ И СОКРАЩЕНИЯ}


АРМ --- Автоматизированное рабочее место

АПМ --- Аппаратно-программный модуль

КПУ --- Контроллер приборов учета

ПУ --- Прибор учета

ПО --- Программное обеспечение

БД --- База данных

ГВС --- Горячее водоснабжение

ХВС --- Холодное водоснабжение

СКАУТ --- Система коммунального автомониторинга управления и телеметрии

\pagebreak



\tableofcontents
% если нужно добавить "Стр." над номерами страниц - раскомментируйте следующую команду
%\addtocontents{toc}{~\hfill\textbf{Стр.}\par}

\pagebreak

\section*{\centering ВВЕДЕНИЕ}
\addcontentsline{toc}{section}{ВВЕДЕНИЕ}
\input{intro} % текст введения в файле intro.tex
\pagebreak

%\input{Post_zad}
\pagebreak
\input{part1}  % первая глава - в файле part1.tex
\pagebreak
\input{part2} % вторая глава - в файле part2.tex
\pagebreak

\input{part3}  % третья глава - в файле part3.tex
\pagebreak

\input{part4} % четвертая глава - в файле part4.tex
\pagebreak

\input{part5}  % пятая глава - в файле part5.tex
\pagebreak

\section*{\centering ЗАКЛЮЧЕНИЕ}
\addcontentsline{toc}{section}{ЗАКЛЮЧЕНИЕ}

В России интерес к тематике Умного города растет с каждым годом, в том числе потому, что многие города подходят к пределам надежности и функциональности существующей инфраструктуры.

В результате проделанной работы было разработано программное обеспечение учета оборудований и анализа данных для системы учета ресурсов.
В работе были выполнены следующие задачи:

\begin{enumerate}
	\item Было рассмотрено несколько проектов Умный город. Выделены три группы проблем при разработке и реализации концепции Умного города в России. Изучены перспективы развития Умного города в Обнинске;
	\item Проведен анализ существующих решений проблемы, выявлены сильные стороны проекта СКАУТ;
	\item Изучен аппаратно-программного комплекса СКАУТ; 
	\item Разработана система квартирного учета потребления ресурсов. Проведен анализ показаний квартирных и домовых приборов учета, с помощью основных алгоритмов поиска проблемных счетчиков электроэнергии и водоснабжения. Разработан автоматизированный анализ данных;
	\item Разработана программа для системы учета ресурсов на языке прошраммирования python;
	\item Протестирована и оптимизирована программа системы учета ресурсов;	
\end{enumerate}

Полученные результаты помогли выявить 78 неисправных счетчиков. В дальнейшем планируется разработать алгоритм анализа данных теплосчетчиков. Возможность снижения расхода тепловой энергии на отопление неотъемлемая часть будущего Умного города.


% оформление библиографии - вариант с БД
\pagebreak

\addcontentsline{toc}{section}{СПИСОК ИСПОЛЬЗОВАННОЙ ЛИТЕРАТУРЫ}
% ВАЖНО: для корректного отображения в списке литературы ссылок на англ.языке в bibtex-описание источника следует добавить поле 
% langid = {english}
\printbibliography

\pagebreak

\section*{ \centering Приложение А} 
\addcontentsline{toc}{section}{Приложение А}

\begin{center}
Формат текстовых данных на домовом сервере \verb|HashMapValue|
\end{center}

\subsection*{Формат файла данных о счетчиках}
Файл представляет собой CSV файл (разделение символом ; ). Название counters.txt
Поля:
\begin{enumerate}
	\item Порт компьютера;
	\item Адрес КПУ на шине;
	\item Номер клеммы;
\end{enumerate}
Пример: /dev/ttyUSB0;05;3

\subsection*{Формат файла данных с показаниями}
Файл представляет собой CSV файл (разделение символом ; ). Название data.txt
Поля:
\begin{enumerate}
	\item Порт компьютера;
	\item Адрес КПУ на шине;
	\item Номер клеммы;
	\item Дата;
	\item Время (час без указания минут);
	\item Показание.
\end{enumerate}
Пример: /dev/ttyUSB0;05;3;10.10.2017;12;34.5

\pagebreak
\section*{ \centering Приложение Б --- Результаты работы} 
\addcontentsline{toc}{section}{Приложение Б}
\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\linewidth]{pics/1}
	\caption{Главное меню}
	\label{fig:1}
\end{figure}
\begin{figure}[H]
	\centering
	\includegraphics[width=0.9\linewidth]{pics/2}
	\caption{Обрыв линии или не обновились показания}
	\label{fig:2}
\end{figure}
\begin{figure}[H]
	\centering
	\includegraphics[width=0.9\linewidth]{pics/4}
	\caption{Добавление нового СКАУТ}
	\label{fig:4}
\end{figure}
\begin{figure}[H]
	\centering
	\includegraphics[width=0.9\linewidth]{pics/6}
	\caption{Замена КПУ}
	\label{fig:6}
\end{figure}
\begin{figure}[H]
	\centering
	\includegraphics[width=0.9\linewidth]{pics/9}
	\caption{Показания прибора учета}
	\label{fig:9}
\end{figure}

\pagebreak

\section*{ \centering Приложение В --- Листинг программы} 
\addcontentsline{toc}{section}{Приложение В}
Метод заполнения таблицы с информацией о замененных КПУ:
\begin{MyCode}
	
	def select_line_state(self):
		self.tableWidget_replaceKPU.hide()
		self.tableWidget_replacePU.hide()
		self.label_replaceKPU.hide()
		self.label_replacePU.hide()
		self.tableWidget_lineState.show()
		self.label_lineState.show()
		self.tableWidget_lineState.setRowCount(0)       
		sql_query = """ SELECT  
			city.city_name, street.street_name,
			house.house_number,
			entrance.num_entr,		 	
			flat.flatfloor,		 	
			flat.num_flat,		 	
			kpu.ser_num,
			counter.klemma,				
			counter.serial_number,
			case counter.type_counter 		 	
			when 1 then 'ГВС'
			when 2 then 'ХВС'
			when 3 then 'Т'
			when 4 then 'Э' 
			end AS Тип,
			marka.name_marka,
			date_value.value_zn,
			date_value.impulse_value,	
			date_value.line_state,	
			date_value.empty,  	 
			counter.last_date
		
		FROM cnt.counter
			left join public.flat
			on flat.id_flat = counter.id_flat
			left join cnt.date_value
			on counter.id_klemma = date_value.id_klemma
			left join cnt.kpu 
			on kpu.id_kpu = counter.id_kpu
			left join cnt.marka
			on counter.id_marka = marka.id_marka
			left join public.entrance
			on entrance.id_entr = flat.id_entr
			left join public.house
			on house.id_house = entrance.id_house
			left join public.street
			on street.id_street = house.id_street
			left join public.city
			on city.id_city = street.id_city  
		
		WHERE 
			date_value.date_val = counter.last_date
			and (date_value.line_state = 1								
			or date_value.empty = 1)								
			and working_capacity = 'TRUE'
			
		order by city.city_name DESC, street.street_name 
		DESC, cast(substring(house.house_number from 
		\'^[0-9]+\') as integer) DESC, 
		cast(entrance.num_entr as integer) DESC,
		flat.num_flat DESC, date_value.date_val DESC,
		counter.type_counter DESC"""
		
		cur = conn.cursor()
		cur.execute(sql_query)   
		data = cur.fetchall()
		for index,row in enumerate(data):
			self.tableWidget_lineState.insertRow(0)
			for k in range(len(row)):
				item = QTableWidgetItem
				('' if data[index][k]==None 
				else str(data[index][k]))                 
				self.tableWidget_lineState.
				setItem(0,k,item)               
		cur.close()    
		self.tableWidget_lineState.resizeColumnsToContents()
		/* ... */
	}
\end{MyCode}

Метод заполнения выпадающего списка:
\begin{MyCode}
def filtr_city(self):
	self.comboBox_city.clear()        
	self.comboBox_city.id = []       
	self.comboBox_city.addItem('')
	cur = self.conn.cursor()
	city_query = """SELECT DISTINCT
		city.city_name,	
		city.id_city 
		FROM    
		public.entrance	
		left join public.house
		on house.id_house = entrance.id_house
		left join public.street
		on street.id_street = house.id_street
		left join public.city
		on city.id_city = street.id_city
		order by city.city_name"""
	cur.execute(city_query)
	data = cur.fetchall()
	self.list_id_city = [0]
\end{MyCode}
Метод слежения таблицы за перемещением курсора мышки:
\begin{MyCode}
def line_selection(self, row, column):
 if self.current_hover != row:
  for j in range(self.tableWidget_kpu.columnCount()):
   if self.tableWidget_kpu.item(self.current_hover,10).text()=='0':        
    self.tableWidget_kpu.item(self.current_hover, j).
    setBackground(QtGui.QColor(245,245,245))                   
   else:
    self.tableWidget_kpu.item(self.current_hover, j).
    setBackground(QBrush(QColor('white')))
   self.tableWidget_kpu.item(row, j).
   setBackground(QBrush(QColor('lightGray')))
  self.current_hover = row	
\end{MyCode}

Метод соединения с локальной базой данных:
\begin{MyCode}
def create_connection_firebird(self):
 try:
  self.connection = None
  self.connection = fdb.connect(
  host=self.ip_rassbery,
  database=self.fdb_path,
  user=self.fdb_login,
  password=self.fdb_password
  )
  print("\nConnection to the FireBird DB successful.
  \nhost = ",self.ip_rassbery,"\nname = ",
  self.fdb_path,"\nuser = ",self.fdb_login,"\npassword = ",
  self.fdb_password)
 except:
  msg = QMessageBox()
  msg.setWindowTitle("Ошибка")
  msg.setText("Не удалось подключиться к локальной базе данных.")
  msg.setInformativeText("Хотите отредактировать данные СКАУТ 
  или продолжить без добавления КПУ в базу данных FireBird?")
  msg.setDetailedText("host = "+str(self.ip_rassbery)+"\nname =
   "+str(self.fdb_path)+"\nuser = "+str(self.fdb_login)+
   "\npassword = "+str(self.fdb_password))
  scautButton = msg.addButton('СКАУТ', QMessageBox.AcceptRole)
  continueButton = msg.addButton('Продолжить',
  QMessageBox.RejectRole)
  msg.exec()
  if msg.clickedButton() == scautButton:
   self.add_scaut = scaut.Add_Scaut(self.val_id_entr,self.conn)
  if msg.clickedButton() == continueButton:
   self.checkBox.setChecked(False)
   self.val_workability = False
  print (traceback.format_exc())
\end{MyCode}

\end{document}          

\end{document}          

